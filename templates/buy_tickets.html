{% extends "base.html" %} {% block content %}
<div class="container">
  <h1 class="display-4 text-center my-5">Choose Your Tickets</h1>
  <form method="post">
    {% csrf_token %}
    <table class="table table-bordered">
      <!-- ... Table content with race and ticket details ... -->
      <td>
        <select name="race" class="form-select">
            {% for race in races %}
            {% if race.name == selected_race_name %}
            <option value="{{ race.name }}" selected>{{ race.name }}</option>
            {% else %}
            <option value="{{ race.name }}">{{ race.name }}</option>
            {% endif %}
            {% endfor %}
        </select>
      </td>
      <td>
        <select name="ticket_type" class="form-select">
          <option value="friday">Friday</option>
          <option value="saturday">Saturday</option>
          <option value="sunday">Sunday</option>
          <option value="all">All 3 Days</option>
        </select>
      </td>
      <td>
        <select name="ticket_category" class="form-select">
          <option value="general">General Admission</option>
          <option value="grandstand">Grandstand Seat</option>
        </select>
      </td>
      <td>
        <select name="quantity" class="form-select">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>6</option>
            <option>7</option>
            <option>8</option>
            <option>9</option>
            <option>10</option>

        </select>
      </td>
    <td>Total Price:</td>
    <td>
        <strong><span id="total_price">£0</span></strong>
    </td>
      <td>
        {% if user.is_authenticated %}
        <button type="submit" class="btn btn-primary">Buy Tickets</button>
        {% endif %} {% if not user.is_authenticated %}
        <strong>Attention: </strong>You need to be signed in to book tickets.
        <a class="btn blue-button" href="{% url 'account_signup' %}"><strong>Sign Up</strong></a>
        <a class="btn blue-button" href="{% url 'account_login' %}"><strong>Login</strong></a>
        </a>
        {% endif %}
      </td>
    </table>
  </form>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const priceTable = {
            'friday-general': 70,
            'friday-grandstand': 150,
            'saturday-general': 100,
            'saturday-grandstand': 200,
            'sunday-general': 120,
            'sunday-grandstand': 250,
            'all-general': 250,
            'all-grandstand': 500,
        };

        function updateTotalPrice() {
            const raceSelect = document.querySelector("select[name='race']");
            const ticketTypeSelect = document.querySelector("select[name='ticket_type']");
            const ticketCategorySelect = document.querySelector("select[name='ticket_category']");
            const quantitySelect = document.querySelector("select[name='quantity']");
            const totalPriceElement = document.getElementById("total_price");

            const race = raceSelect.value;
            const ticketType = ticketTypeSelect.value;
            const ticketCategory = ticketCategorySelect.value;
            const quantity = parseInt(quantitySelect.value);

            const optionKey = `${ticketType}-${ticketCategory}`;
            const price = priceTable[optionKey] || 0;
            const total = price * quantity;

            totalPriceElement.textContent = `£${total.toFixed(2)}`;
        }

        // Add event listeners to update the total price when the user selects different options
        document.querySelector("select[name='race']").addEventListener("change", updateTotalPrice);
        document.querySelector("select[name='ticket_type']").addEventListener("change", updateTotalPrice);
        document.querySelector("select[name='ticket_category']").addEventListener("change", updateTotalPrice);
        document.querySelector("select[name='quantity']").addEventListener("change", updateTotalPrice);
    });
</script>
{% endblock %}
